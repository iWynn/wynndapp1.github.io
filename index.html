<!DOCTYPE html>

<html>

<head>
  <meta charset="utf-8">
  <title>一支穿云箭</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="一支穿云箭,dapp,区块链,星云">
  <meta name="description" content="一支穿云箭，千军万马来相见">
  <link rel="stylesheet" href="res/layui/css/layui.css">
  <link rel="stylesheet" href="res/css/global.css">
</head>

<body>

  <div class="fly-header layui-bg-black">
    <div class="layui-container">
      <a class="fly-logo" href="/">
        <img src="res/images/w.png" alt="layui">
      </a>
    </div>
  </div>



  <div class="layui-container" style="margin-top: 10px">
    <div class="layui-row layui-col-space15">
      <div class="layui-col-md8">
        <div class="fly-panel" style="display: none">
          <div class="fly-panel-title fly-filter">
            <a>置顶</a>
            <a href="#signin" class="layui-hide-sm layui-show-xs-block fly-right" id="LAY_goSignin" style="color: #FF5722;">去签到</a>
          </div>
          <ul class="fly-list">
            <li>
              <a href="user/home.html" class="fly-avatar">
                <img src="https://tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg" alt="贤心">
              </a>
              <h2>
                <a class="layui-badge">动态</a>
                <a href="jie/detail.html">基于 layui 的极简社区页面模版</a>
              </h2>
              <div class="fly-list-info">
                <a href="user/home.html" link>
                  <cite>贤心</cite>
                  <i class="iconfont icon-renzheng" title="认证信息：XXX"></i>
                  <i class="layui-badge fly-badge-vip">VIP3</i>
                </a>
                <span>刚刚</span>

                <span class="fly-list-kiss layui-hide-xs" title="悬赏飞吻">
                  <i class="iconfont icon-kiss"></i> 60</span>
                <span class="layui-badge fly-badge-accept layui-hide-xs">已结</span>
                <span class="fly-list-nums">
                  <i class="iconfont icon-pinglun1" title="回答"></i> 66
                </span>
              </div>
              <div class="fly-list-badge">
                <!--
              <span class="layui-badge layui-bg-black">置顶</span>
              <span class="layui-badge layui-bg-red">精帖</span>
              -->
              </div>
            </li>
          </ul>
        </div>

        <div class="fly-panel" style="margin-bottom: 0;">

          <div class="fly-panel-title fly-filter">
            <a href="" class="layui-this">游戏</a>

          </div>

          <ul class="fly-list">
            <div id="view"></div>
          </ul>


        </div>
      </div>
      <div class="layui-col-md4">

        <div class="fly-panel">
          <h3 class="fly-panel-title">寻找组织</h3>
          <div class="fly-panel fly-panel-user" pad20>
            <div class="layui-tab layui-tab-brief" lay-filter="user">
              <div class="layui-form layui-tab-content" id="LAY_ucm" style="padding: 20px 0;">
                <div class="layui-tab-item layui-show">
                  <div class="layui-form layui-form-pane">
                    <form class="layui-form" action="">
                      <div class="layui-form-item">
                        <label for="L_email" class="layui-form-label">游戏名</label>
                        <div class="layui-input-inline">
                          <input type="text" id="L_email" name="gameName" required lay-verify="required" autocomplete="off" class="layui-input">
                        </div>
                      </div>
                      <div class="layui-form-item">
                        <label for="L_username" class="layui-form-label">游戏昵称</label>
                        <div class="layui-input-inline">
                          <input type="text" id="L_username" name="nickName" required lay-verify="required" autocomplete="off" class="layui-input">
                        </div>
                      </div>
                      <div class="layui-form-item">
                        <label for="L_pass" class="layui-form-label">服务器</label>
                        <div class="layui-input-inline">
                          <input type="text" id="L_pass" name="serverName" lay-verify="required" autocomplete="off" class="layui-input">
                        </div>
                      </div>
                      <div class="layui-form-item">
                        <label for="L_repass" class="layui-form-label">公会名称</label>
                        <div class="layui-input-inline">
                          <input type="text" id="L_repass" name="partyName" lay-verify="required" autocomplete="off" class="layui-input">
                        </div>
                      </div>
                      <div class="layui-form-item">
                        <label for="L_vercode" class="layui-form-label">留言</label>
                        <div class="layui-input-inline">
                          <input type="text" id="L_vercode" name="msg" autocomplete="off" class="layui-input">
                        </div>
                      </div>
                      <div class="layui-form-item">
                        <button class="layui-btn" lay-submit="" lay-filter="formDemo">立即录入</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <ul class="fly-panel-main fly-list-static" style="display: none;">
            <li>
              <a href="http://fly.layui.com/jie/4281/" target="_blank">layui 的 GitHub 及 Gitee (码云) 仓库，欢迎Star</a>
            </li>
            <li>
              <a href="http://fly.layui.com/jie/5366/" target="_blank">
                layui 常见问题的处理和实用干货集锦
              </a>
            </li>
            <li>
              <a href="http://fly.layui.com/jie/4281/" target="_blank">layui 的 GitHub 及 Gitee (码云) 仓库，欢迎Star</a>
            </li>
            <li>
              <a href="http://fly.layui.com/jie/5366/" target="_blank">
                layui 常见问题的处理和实用干货集锦
              </a>
            </li>
            <li>
              <a href="http://fly.layui.com/jie/4281/" target="_blank">layui 的 GitHub 及 Gitee (码云) 仓库，欢迎Star</a>
            </li>
          </ul>
        </div>

      </div>
    </div>
  </div>

  <div class="fly-footer">
    <p>
      <a href="http://fly.layui.com/" target="_blank">Fly社区</a> 2017 &copy;
      <a href="http://www.layui.com/" target="_blank">layui.com 出品</a>
    </p>
  </div>

  <script src="res/layui/layui.js"></script>
  <script type="text/javascript" src="res/js/nebPay.js"></script>
  <script type="text/javascript" src="res/js/jquery-1.8.3.min.js"></script>
  <script>
    var NebPay = require("nebpay");
    var nebPay = new NebPay();
    var serialNumber; //transaction serial number
    var intervalQuery; //periodically query tx results
    var dappAddress = "n1kzW2iPXVpXUvWbpZoLHYswwZvQwEaRjuX"; //the smart contract address of your Dapp
    // if (typeof (webExtensionWallet) === "undefined") {
    //   alert("请首先安装webExtensionWallet插件");
    // }

    function searchPublicPlan() {
      var to = dappAddress
      var value = "0"
      var callFunction = "getAll" //the function name to be called
      var callArgs = "" //the parameter, it's format JSON string of parameter arrays, such as'["arg"]','["arg1","arg2]'        
      nebPay.simulateCall(to, value, callFunction, callArgs, {
        listener: searchHandle
      });

      function searchHandle(resp) {
        if (resp == null || resp.execute_err != "") {
          alert("查询失败...请刷新页面重试！");
          return;
        }
        var result = JSON.parse(resp.result);
        layui.use('laytpl', function (laytpl) {

          var getTpl = demo.innerHTML;
          // console.log("getTpl:"+getTpl)
          var view = document.getElementById('view');
          // var data=eval(jsonstr);

          laytpl(getTpl).render(result, function (html) {
            view.innerHTML = html;
          });

        });
      };
    }
    window.onload = searchPublicPlan;
  </script>
  <script id="demo" type="text/html">
    {{# layui.each(d, function(index, item){ }}
    <li>
      <h2>
        <a href="#">{{item.key}}</a>
      </h2>
    </li>

    {{# }); }}
  </script>
  <script type="text/javascript">
    var NebPay = require("nebpay");
    var nebPay = new NebPay();

    if (typeof (webExtensionWallet) === "undefined") {
      alert("请首先安装webExtensionWallet插件");
    }
    layui.use('form', function () {
      var form = layui.form;
      //监听提交
      form.on('submit(formDemo)', function (data) {
        //layer.msg(JSON.stringify(data.field));
        var dappAddress = "n1kzW2iPXVpXUvWbpZoLHYswwZvQwEaRjuX";
        var to = dappAddress
        var value = "0"
        var callFunction = "save" //the function name to be called
        var callArgs = "[\"" + data.field.gameName + "\",\"" + data.field.nickName + "\",\"" + data.field.serverName +
          "\",\"" + data.field.partyName + "\",\"" + data.field.msg + "\"]";
        console.log(callArgs)
        //Send transaction (here is smart contract call)
        serialNumber = nebPay.Call(to, value, callFunction, callArgs, options, {
          listener: (res) => {
            console.log('listener', res)
            try {
              resolve(JSON.parse(res.result))
            } catch (e) {
              reject(res.result)
            }
          }
        })
        return false;
      });
    });
  </script>
</body>

</html>